# 실행 컨텍스트(Execution Context)

실행 컨텍스트(Execution Context) 실행되는 코드에 대한 스코프, 변수, 객체, 호출, this, 함수, closure 와 같은 코드에 제공할 환경 정보를 담고 있는 객체이다. 자바스크립트 엔진이 코드를 실행할 때 필요한 코드 블록에 대한 모든 정보를 담고 있다. 실행 컨텍스트는 실행 가능한 코드를 형식에 맞게 관리하고, 코드 실행 중 발생하는 모든 것을 정확하게 제어하는 역할을 한다. 

## 실행 컨텍스트의 세 가지 구성 요소

1. 변수 환경(Variable Environment)
   변수, 함수 선언, 매개 변수 등이 포함된다. 이 환경은 코드 실행 동안 생성되고 수정되는 환경의 스냅샷으로 생각할 수 있다.
2. 외부 환경(Outer Environment)
   현재 컨텍스트와 관련된 외부 스코프를 가리킨다. 현재 실행 중인 함수 또는 블록 외부에서 접근할 수 있는 변수나 함수를 참조한다. 실행 중인 함수 또는 코드 블록이 선언된 시점에서 접근 가능한 모든 변수와 함수를 포함하는 스코프를 참조한다. 이 외부 환경 참조는 특정 실행 컨텍스트가 자신의 부모 스코프에 있는 변수와 함수에 접근할 수 있도록 해준다.
3. this 바인딩
   실행 컨텍스트는 `this`키워드가 가리키는 값을 결정한다. `this`의 값은 함수 호출 방식에 따라 달라진다. 

## 실행 컨텍스트의 역할

1. 코드 실행 환경 제공
   현재 실행 중인 코드 블록(함수, 전역코드, eval)에 대한 필요한 정보를 담고 있다. 실행되는 동안 필요한 모든 변수, 함수, 매개변수 등을 포함
2. 스코프 관리
   변수와 함수의 스코프 결정, 각 실행 컨텍스트는 자체적인 변수 환경을 가지며 이를 통해 변수와 함수가 현재 실행 컨텍스트에서 접근 가능한지를 관리한다. 외부 환경 참조를 통해 클로저와 같은 기능을 지원하며, 상위 스코프와의 연결을 유지한다.
3. 콜스택 관리
   콜스택은 함수의 호출이 이루어질 때마다 해당 함수의 실행 컨텍스트를 스택에 푸쉬하고, 함수 실행이 완료되면 스택에서 팝하는 방식으로 동작한다. 함수 호출의 순서를 관리하고 함수 반환 후 실행할 위치를 정확히 추적한다.
4. 변수의 생명 주기 관리
   해당 컨텍스트 내에서 선언된 변수와 함수의 생성과 소멸을 관리한다. 변수, 함수의 호이스팅, 클로저 등의 동작 원리와 직접적으로 관련이 있다.
5. `this` 바인딩 결정
   `this` 키워드가 가르키는 객체를 결정한다. `this`의 값은 함수가 어떻게 호출되는지에 따라 달라진다.

## 실행 컨텍스트 유형

1. 전역 실행 컨텍스트(Global Execution Context)
   코드가 처음 실행될 때 생성되는 컨텍스트이다. 전역 환경에서 변수와 함수가 저장되고, 전역 객체(브라우저에서는 `window`, Node.js에서는 `global`)와 `this`가 여기 포함된다. 
2. 함수 실행 컨텍스트(Function Execution Context)
   함수가 호출될 때마다 생성된다. 각 함수 호출마다 고유한 실행 컨텍스트가 만들어진다. 
3. Eval 실행 컨텍스트(Eval Execution Context)
   `eval` 함수를 통해 실행되는 코드에 대한 컨텍스트이다. 보안과 최적화 문제로 사용을 권장하지 않는다.

## 실행 컨텍스트와 콜 스택(call stack)의 동작 순서

1. 전역 실행 컨텍스트 초기화
   - 프로그램이 실행되면 Javascript 엔진을 가장 먼저 전역 실행 컨텍스트(Global Execution Context, GEC)를 생성한다. 
   - 해당 컨텍스트는 전역 변수와 전역 함수를 포함하며, 전역 스코프를 관리한다.
   - 전역 실행 컨텍스트는 콜 스택 가장 바닥에 위치하고 프로그램이 종료될때까지 유지된다.
2. 함수 호출 발생
   - 함수가 호출되면, 해당 함수의 실행 컨텍스트(Function Execution Context, FEC)가 생성된다.
   - 실행 컨텍스트는 함수의 매개변수, 지역 변수, 그리고 함수 본문의 코드를 포함한다.
   - 함수가 참조하는 외부 환경(lexical environment)의 정보를 포함하여 클로저를 지원한다.
3. 콜스택 푸시
   - 생성된 함수의 실행 컨텍스트를 콜 스택의 맨 위에 푸쉬한다.
   - 현재 실행 중인 함수의 컨텍스트가 스택의 맨 위에 위치하게 되므로, Javascript 엔진은 이 컨텍스트를 기준으로 코드를 실행한다.
4. 함수 실행
   - 콜 스택의 맨 위에 있는 실행 컨텍스트에서 함수 코드가 순차적으로 실행된다.
   - 내부 함수 호출, 조건문, 반복문 등의 제어 구조가 처리된다.
5. 함수 실행 완료
   - 함수 코드 실행이 완료되면, 그 겨로가가 반환되고, 해당 함수의 실행 컨텍스트는 콜스택에서 팝(POP)된다.
   - 함수가 다른 함수를 호출했더라도 각 함수의 실행 컨텍스트는 호출 순서대로 스택에 쌓이고, 완료 순서대로 스택에서 제거된다.
6. 제어 반환
   - 함수의 실행 컨텍스트가 제거되면, 제어는 콜스택의 바로 아래에 있는 이 전 실행 컨텍스트로 반환된다.
   - 이 과정을 통해 프로그램은 함수 호출의 중첩과 복귀를 정확히 처리할 수 있다.
7. 전역 실행 컨텍스트 종료
   - 모든 함수의 실행이 완료되고, 전역 코드의 실행이 끝나면, 전역 실행 컨텍스트 또한 콜스택에서 팝되어 프로그램이 종료된다.