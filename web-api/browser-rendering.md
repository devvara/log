# 웹 브라우저의 렌더링 과정

웹 브라우저의 렌더링 과정은 사용자가 웹 페이지에 접속했을때 HTML, CSS, Javascript 와 같은 코드를 시각적인 요소로 변환하는 단계를 말한다.

## CRP(Critical Rendering Path) 중요 렌더링 경로

웹 페이지가 처음 표시될 때까지의 중요한 단계를 이야기 한다. 사용자에게 첫 화면이 빨리 표시되도록 하는 데 중점을 둔 렌더링 과정의 핵심 부분이다. 

![Critical Rendering Path](https://raw.githubusercontent.com/devvara/support-repo/master/media/images/log/web-api/browser-rendering.png)

<br/>

1. HTML 파싱 및 DOM 트리 구축

   브라우저가 HTML 문서를 읽고 DOM 트리를 생성한다. 이 트리는 웹 페이지의 구조적 표현으로, 각 HTML 요소를 노드로 포함한다.

2. CSS 파싱 및 CSSOM 트리 구축

   동시에 CSS 정보를 읽고 처리하여 CSSOM 트리를 구축한다. CSSOM 트리는 웹 페이지의 각 요소에 적용될 스타일 정보를 포함한다.

3. 렌더 트리 생성

   DOM과 CSSOM이 준비되면, 브라우저는 이 두 트리를 결합하여 렌더 트리를 생성한다. 렌더 트리는 화면에 실제로 표시될 요소들을 포함하며, 각 요소의 시각적 속성을 담고 있다.
   (* 시각적 속성만 포함되며 head, script, display: none인 요소들은 제외된다.)

4. 레이아웃(레이아웃 처리)

   렌더 트리가 완성되면, 각 요소의 정확한 위치와 크기를 계산하는 레이아웃 과정이 이루어진다. 페이지 각 요소가 화면 상에서 어디에 위치할지를 정하는 단계이다.

5. 페인팅(화면에 표시)

   요소들의 위치와 크기가 결정되면, 페인팅 과정을 통해 이 요소들을 화면에 그린다. 이때 색상, 이미지, 텍스트 등의 시각적 디테일이 적용된다.

6. 합성(다양한 레이어 합성)

   페인팅 단계까지 여러 레이어로 구성된 요소들을 하나의 페이지로 합성하여 최종적으로 사용자에게 표시한다.

<br/>

![Critical Rendering Path](https://raw.githubusercontent.com/devvara/support-repo/master/media/images/log/web-api/browser-rendering-layout.png)

- 왼쪽이 DOM 트리, 오른쪽이 랜더 트리

CRP를 최적화 하는 것은 웹 페이지의 로딩 속도를 개선하는데 매우 중요하며, 사용자 경험을 크게 향상 시킬 수 있다. 

## 리플로우(Reflow)와 리페인트(Repaint)

사용자와의 상호작용이나 자바스크립트에 동적인 DOM 조작이 일어날 때의 브라우저 렌더링 과정

### 리플로우 (Reflow)

리플로우는 레이아웃(위치와 크기)에 영향을 주는 변경이 일어날 때 발생한다.  레이아웃 계산이 필요한 상황에서 리플로우가 트리거된다. 

주요 발생 상황
- DOM 요소 추가, 제거, 업데이트
- 요소의 위치 변경
- 요소의 크기 변경
- 폰트 변경
- 윈도우 또는 탭의 크기 변경
- 페이지 초기 랜더링

리플로우는 요소의 변경이 상위 요소나 하위 요소에 영양을 줄 경우, 그에 연관된 모든 요소들의 레이아웃을 다시 계산해야 하므로 리플로우가 발생한다. 이는 성능을 크게 저하시킬 수 있다.

### 리페인트 (Repaint)

리페인트는 요소의 시각적인 변경이 발생했을 때 일어난다. 레이아웃 변경이 반드시 필요하지는 않지만, 시각적 속성의 변경으로 인해 요소를 다시 그려야 할 때 발생한다.

주요 발생 상황
- 색상 변경
- 배경 변경
- 가시성 변경
- 그림자 등의 시각적 효과 변경
  
리페인트는 리플로우보다는 작업 비용이 적게 들지만, 여전히 성능에 영향을 미칠 수 있다.

### 성능 최적화

리플로우와 리페인트는 가능한 최소화하는 것이 좋다.
- CSS 클래스 변경: 한 번에 여러 스타일을 변경하기 위해 CSS 클래스를 변경하는 방법
- DOM 변경 최소화, DOM 변경 시 가능한 배치처리로 한 번에 변경
- 복잡한 애니메이션이나 비번히 변경되는 요소는 CSS의 'will-change' 속성 사용
